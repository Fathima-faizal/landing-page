<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VisionVogue - ProductDetails</title>
    <link rel="stylesheet" href="/css/checkout.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    
    <header>
        <nav class="navbar">
            <ul class="nav-links">
                <li><a href="/home">Home</a></li>
                <li><a href="/shop">shop</a></li>
                <li><a href="#">About</a></li>
                <li><a href="#">Contact us</a></li>
            </ul>
            <div class="logo">VisionVogue</div>
            <div class="nav-icons">
               <a href="/wishlist" ><i class="fa-regular fa-heart"></i></a>
               <a href="/cart"> <i class="fa-solid fa-cart-shopping"></i></a>
              <a href="/profile" > <i class="fa-regular fa-user"></i></a>
            </div>
        </nav>
    </header>
     <main class="checkout-container">
    <div class="checkout-stepper">
        <div class="step completed"><span>1</span> Cart</div>
        <div class="step active"><span>2</span> Checkout</div>
        <div class="step"><span>3</span> Payment</div>
    </div>

    <div class="checkout-grid">
        <section class="address-section">
            <div class="section-title">
                <i class="fa-solid fa-location-dot"></i>
                <h3>Delivery Address</h3>
            </div>

            <div class="address-grid">
                <% if (userAddress && userAddress.length > 0) { %>
                    <% userAddress.forEach((address, i) => { %>
                        <div class="address-card">
                            <input type="radio" name="selectedAddress" value="<%= address._id %>" id="address<%= i %>" <%= i===0 ? 'checked' : '' %>>
                            <label for="address<%= i %>" class="address-label">
                                <span class="address-type"><%=address.addressType%></span>
                                <div class="address-details">
                                    <p class="name"><strong><%= address.houseName %></strong></p>
                                    <p><%= address.city %>, <%= address.zipCode %></p>
                                    <p><%= address.country %></p>
                                    <p class="phone"><i class="fa-solid fa-phone"></i> <%= address.phoneNumber %></p>
                                </div>
                                <button type="button" class="edit-link" onclick="window.location.href='/editAddress?id=<%=address._id%>'">
                                    Edit
                                </button>
                            </label>
                        </div>
                    <% }) %>
                <% } %>
                
                <div class="add-address-card" onclick="window.location.href='/addAddress'">
                    <i class="fa-solid fa-plus"></i>
                    <p>Add New Address</p>
                </div>
            </div>

            <div class="section-title mt-40">
                <i class="fa-solid fa-credit-card"></i>
                <h3>Payment Method</h3>
            </div>
            <div class="payment-options">
                <div class="payment-card active">
                    <input type="radio" name="paymentMethod" value="COD" checked>
                    <div class="payment-info">
                        <i class="fa-solid fa-hand-holding-dollar"></i>
                        <span>Cash On Delivery</span>
                    </div>
                </div>
                </div>
        </section>

        <aside class="order-summary">
            <h3>Order Summary</h3>
            <div class="summary-items">
                <% if (cart && cart.items && cart.items.length > 0) { %>
                    <% cart.items.forEach(item => { %>
                        <div class="summary-item">
                            <div class="item-img-box">
                                <img src="/uploads/<%= item.proudctId.productimage[0] %>" alt="product">
                                <span class="qty-badge"><%= item.quantity %></span>
                            </div>
                            <div class="item-desc">
                                <p class="brand"><%= item.proudctId.brand %></p>
                                <p class="p-name"><%= item.proudctId.productName %></p>
                            </div>
                            <span class="price">₹<%= item.proudctId.salesPrice * item.quantity %></span>
                        </div>
                    <% }) %>
                <% } %>
            </div>

            <div class="price-breakdown">
                <div class="price-row">
                    <span>Subtotal</span>
                    <span>₹<%= grandTotal %></span>
                </div>
                <div class="price-row">
                    <span>Shipping</span>
                    <span class="free">FREE</span>
                </div>
                <div class="price-row total">
                    <span>Total Amount</span>
                    <span>₹<%= grandTotal %></span>
                </div>
            </div>

            <button class="place-order-btn" onclick="placeOrder()">
                CONFIRM ORDER <i class="fa-solid fa-arrow-right"></i>
            </button>
            <p class="safe-checkout"><i class="fa-solid fa-shield-halved"></i> 100% Safe & Secure Checkout</p>
        </aside>
    </div>
</main>
     <footer>
        <div class="footer-content">
            <div class="footer-column">
                <h4>About Us:</h4>
                <a href="#">Our Story</a>
                <a href="#">Privacy Policy</a>
                <a href="#">Terms</a>
                <a href="#">FAQ</a>
            </div>
            <div class="footer-column">
                <h4>Support:</h4>
                <a href="#">Shipping Policy</a>
                <a href="#">Returns</a>
                <a href="#">Order Tracking</a>
                <a href="#">Help</a>
            </div>
            <div class="footer-column">
                <h4>My Account:</h4>
                <a href="#">Profile</a>
                <a href="#">My Orders</a>
                <a href="#">Wishlist</a>
                <a href="#">Refer & Earn</a>
            </div>
            <div class="footer-column">
                <h4>Contact:</h4>
                <p>Email: visionvogue@gmail.com</p>
                <p>Phone: 8923457190</p>
            </div>
        </div>
        <p class="copyright">© 2026 Eyewear Store. All rights reserved.</p>
    </footer>
    
   <script>
    window.addEventListener( "pageshow", function ( event ) {
        var historyTraversal = event.persisted || 
                               ( typeof window.performance != "undefined" && 
                                 window.performance.navigation.type === 2 );
        if ( historyTraversal ) {
            window.location.reload();
        }
    });
    window.history.pushState(null, null, window.location.href);
    window.onpopstate = function () {
        window.history.go(1);
    };
    function placeOrder() {
    const selectedAddress = document.querySelector('input[name="selectedAddress"]:checked').value;

    $.ajax({
        url: '/placeOrder',
        method: 'POST',
        data: {
            addressId: selectedAddress,
            paymentMethod: 'COD'
        },
        success: (response) => {
            if (response.success) {
                window.location.href = '/orderSuccess';
            } else {
                Swal.fire("Error", "Order failed", "error");
            }
        }
    });
}
   </script>
</body>
</html>