<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VisionVogue - Shop</title>
    <link rel="stylesheet" href="/css/shop.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    
    <header>
        <nav class="navbar">
            <ul class="nav-links">
                <li><a href="/home">Home</a></li>
                <li><a href="/shop">shop</a></li>
                <li><a href="#">About</a></li>
                <li><a href="#">Contact us</a></li>
            </ul>
            <div class="logo">VisionVogue</div>
            <div class="nav-icons">
               <a href="/wishlist" ><i class="fa-regular fa-heart"></i></a>
               <a href="/cart" class="cart-icon-container"> <i class="fa-solid fa-cart-shopping">
                <% if (locals.cartCount > 0) { %>
            <span class="cart-badge"><%= cartCount %></span>
        <% } %>
               </i></a>
              <a href="/profile" > <i class="fa-regular fa-user"></i></a>
            </div>
        </nav>
    </header>
    <main class="shop-wrapper">
    <div class="shop-container">
        <aside class="sidebar-premium">
            <div class="filter-header">
                <h3><i class="fa-solid fa-sliders"></i> Filters</h3>
                <a href="/shop" class="reset-link">Reset All</a>
            </div>

            <form action="/filter" method="get" id="filterForm">
                <div class="filter-section">
                    <h4 class="filter-title">Categories</h4>
                    <div class="filter-list custom-scrollbar">
                        <% for(let i=0; i < category.length; i++) { %>
                            <label class="checkbox-container">
                                <input type="checkbox" name="category" value="<%= category[i]._id %>">
                                <span class="checkmark"></span>
                                <span class="label-text"><%= category[i].name %></span>
                            </label>
                        <% } %>
                    </div>
                </div>

                <div class="filter-section">
                    <h4 class="filter-title">Brands</h4>
                    <div class="filter-list custom-scrollbar">
                        <% for(let i=0; i < brand.length; i++) { %>
                            <label class="checkbox-container">
                                <input type="checkbox" name="brand" value="<%= brand[i]._id %>">
                                <span class="checkmark"></span>
                                <span class="label-text"><%= brand[i].name %></span>
                            </label>
                        <% } %>
                    </div>
                </div>

                <div class="filter-section">
                    <h4 class="filter-title">Price Range</h4>
                    <div class="price-range-inputs">
                        <input type="number" name="minPrice" placeholder="Min" value="<%=locals.minPrice||''%>">
                        <div class="range-dash"></div>
                        <input type="number" name="maxPrice" placeholder="Max" value="<%=locals.maxPrice||''%>">
                    </div>
                    <button type="submit" class="apply-filter-btn">Apply Filters</button>
                </div>
            </form>
        </aside>

        <section class="shop-content">
            <div class="top-bar">
                <div class="search-premium">
                    <form action="/search" method="get">
                        <i class="fa-solid fa-magnifying-glass"></i>
                        <input type="text" name="search" placeholder="Search for eyewear...">
                        <button type="submit">Search</button>
                    </form>
                </div>

                <div class="sort-premium">
                    <form action="/sort" method="post">
                        <select name="sortOption" onchange="this.form.submit()">
                            <option value="default">Sort by: Default</option>
                            <option value="az" <%= locals.selectedSort === 'az' ? 'selected' : '' %>>Name: A to Z</option>
                            <option value="za" <%= locals.selectedSort === 'za' ? 'selected' : '' %>>Name: Z to A</option>
                            <option value="low-high" <%= locals.selectedSort === 'low-high' ? 'selected' : '' %>>Price: Low to High</option>
                            <option value="high-low" <%= locals.selectedSort === 'high-low' ? 'selected' : '' %>>Price: High to Low</option>
                        </select>
                    </form>
                </div>
            </div>

            <div class="product-grid-premium">
                <% for(let i=0; i < products.length; i++){ %>
                    <div class="product-card-v2">
                        <div class="card-media">
                            <span class="wishlist-btn" onclick="addtoWishlist('<%=products[i]._id%>')">
                                <i id="wishlist-icon-<%=products[i]._id%>" 
                                   class="fa-heart <%= products[i].isWishlisted ? 'fa-solid active' : 'fa-regular' %>"></i>
                            </span>
                            <img src="/uploads/<%= products[i].productimage[0] %>" alt="<%= products[i].productName %>">
                            <div class="card-overlay">
                                <a href="/productDetails?id=<%=products[i]._id%>" class="quick-view">View Details</a>
                            </div>
                        </div>
                        
                        <div class="card-body">
                            <span class="card-category"><%= products[i].category.name %></span>
                            <h3 class="card-title"><%= products[i].productName %></h3>
                            <div class="card-price-row">
                                <span class="price-now">₹<%= products[i].salesPrice.toLocaleString('en-IN') %></span>
                                <span class="price-old">₹<%= products[i].regularPrice.toLocaleString('en-IN') %></span>
                            </div>
                        </div>
                    </div>
                <% } %>
            </div>

            <div class="pagination-container">
                <%for(let i=1;i<=totalpages;i++){%>
                    <a href="?page=<%= i %>&search=<%= search %>" 
                       class="page-num <%=(i===currentPage)? 'active':''%>"><%= i %></a>
                <%}%>
            </div>
        </section>
    </div>
</main>
     <footer>
        <div class="footer-content">
            <div class="footer-column">
                <h4>About Us:</h4>
                <a href="#">Our Story</a>
                <a href="#">Privacy Policy</a>
                <a href="#">Terms</a>
                <a href="#">FAQ</a>
            </div>
            <div class="footer-column">
                <h4>Support:</h4>
                <a href="#">Shipping Policy</a>
                <a href="#">Returns</a>
                <a href="#">Order Tracking</a>
                <a href="#">Help</a>
            </div>
            <div class="footer-column">
                <h4>My Account:</h4>
                <a href="#">Profile</a>
                <a href="#">My Orders</a>
                <a href="#">Wishlist</a>
                <a href="#">Refer & Earn</a>
            </div>
            <div class="footer-column">
                <h4>Contact:</h4>
                <p>Email: visionvogue@gmail.com</p>
                <p>Phone: 8923457190</p>
            </div>
        </div>
        <p class="copyright">© 2026 Eyewear Store. All rights reserved.</p>
    </footer>
    
   <script>
    function moveSlide(index) {
    const wrapper = document.getElementById('offerWrapper');
    const dots = document.querySelectorAll('.dot');
    
    // Move the wrapper by 100% (which is 2 cards)
    wrapper.style.transform = `translateX(-${index * 50}%)`;
    
    // Update active dot
    dots.forEach(dot => dot.classList.remove('active'));
    dots[index].classList.add('active');
}
    window.addEventListener( "pageshow", function ( event ) {
        var historyTraversal = event.persisted || 
                               ( typeof window.performance != "undefined" && 
                                 window.performance.navigation.type === 2 );
        if ( historyTraversal ) {
            window.location.reload();
        }
    });
    window.history.pushState(null, null, window.location.href);
    window.onpopstate = function () {
        window.history.go(1);
    };
    
    function addtoWishlist(productId){
        $.ajax({
            url:'/addtoWishlist',
            method:'POST',
            data:{productId:productId},
            success:(response)=>{
                if(response.status){
                    const icon = document.getElementById(`wishlist-icon-${productId}`);
                    icon.classList.remove('fa-regular');
                icon.classList.add('fa-solid', 'is-wishlisted');
                    swal.fire({
                        icon:'success',
                        title:'Added to wishlist',
                        text:'The product has been added to your Wishlist',
                        timer:2000
                    })
                }else{
                    swal.fire({
                        icon:'info',
                        title:'Already in wishlist',
                        text:response.message,
                        timer:2000
                    })
                }
            },
            error:(error)=>{
                swal.fire({
                    icon:'error',
                    title:'Error',
                    text:'There are was error adding the product to your wishlist',
                    timer:2000
                })
            }
        })
    }
</script>
</body>
</html>